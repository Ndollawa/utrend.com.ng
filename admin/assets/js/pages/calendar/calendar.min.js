/**
 *  Document   : calendar.js
 *  Author     : redstar
 *  Description: Script for calendar data
 *
 **/
//  $(document).ready(function(){
//                 var e = new Date,
//                     t = e.getDate(),
//                     a = e.getMonth(),
//                     n = e.getFullYear(),
//                     r = {};
//                 $("#calendar").removeClass("mobile");
//                  r = {
//                     left: "prev,next,today",
//                     center: "title",
//                     right: "month,agendaWeek,agendaDay"
//                 };
//                 var l = function(e) {
//                         var t = {
//                             title: $.trim(e.text())
//                         };
//                         e.data("eventObject", t), e.draggable({
//                             zIndex: 999,
//                             revert: !0,
//                             revertDuration: 0
//                         })
//                     },
//                     o = function(e) {
//                         e = 0 === e.length ? "Untitled Event" : e;
//                        /* var t = $('<div class="external-event label label-event">' + e + "</div>");*/
//                         var t = $('<div class="external-event label label-event-' +e+'">' + e + "</div>");
//                         jQuery("#event_box").append(t), l(t)
//                     };
//                 $("#external-events div.external-event").each(function() {
//                     l($(this))
//                 }), $("#event_add").unbind("click").click(function() {
//                     var e = $("#event_title").val();
//                     o(e)
//                 }), $("#event_box").html(""), o("holiday"), o("solemn assembly"), o("meeting"), o("competition"), o("congress"), o("student week");
//                  $("#calendar").fullCalendar("destroy");
//                  $("#calendar").fullCalendar({
//                     header: r,
//                     defaultView: "month",
//                     slotMinutes: 15,
//                       /***** events ********/
//                     events: '../calendar/load-event.php',
//                     editable: !0,
//                     droppable: !0,
//                     drop: function(e, t) {
//                         var a = $(this).data("eventObject"),
//                             n = $.extend({}, a);
//                         n.start = e, n.allDay = t, n.className = $(this).attr("data-class");
//                          // $("#calendar").fullCalendar("renderEvent", n, !0);
//                          $("#drop-remove").is(":checked") && $(this).remove();
//                      var r = Object.values(n);
//                     var title =r[0];
//                     var start = n.start;
//                     var allDay = n.allDay;
//                     var details = prompt('Enter Event details:');
//                     // var img = prompt('<input type="file" />');
                
//                      var action = 'add-event';
//                      $.ajax({
//                       url:"../queries/calendar-queries.php",
//                       type:"POST",
//                       data:{action:action, eventTitle:title, startDate:start, allDay:allDay, eventDetails:details},
//                       success:function()
//                       {
//                        $("#calendar").fullCalendar("refetchEvents");
//                        alert("Event Updated");
//                       }
//                      });
//                    },
                   
                 
//                       editable:true,
//                       eventResize:function(event)
//                       {
//                        var start =event.start;
//                        var end =  event.end;
//                        var title = event.title;
//                        var id = event.id;
//                        var action = 'edit-event';
//                        $.ajax({
//                         url:"../queries/calendar-queries.php",
//                         type:"POST",
//                         data:{action:action,title:title, start:start, end:end, id:id},
//                         success:function(){
//                          calendar.fullCalendar('refetchEvents');
//                          alert('Event Update');
//                         }
//                        })
//                       },
//                     viewRender: function(view, element) {
//                                   $('.fc-center')[0].children[0].innerText = view.title.replace(new RegExp("undefined", 'g'), "");
//                               },
//                       eventDrop:function(event, delta, revertFunc, jsEvent, ui, view)
//                       {
//                        var start =  event.start;
//                        // var end =  formatDate(event.end, "Y-MM-DD HH:mm:ss"); endDate:end
//                        var title = event.title;
//                        var id = event.id;
//                        var action = 'edit-event';
//                        $.ajax({
//                         url:"../queries/calendar-queries.php",
//                         type:"POST",
//                         data:{action:action, title:title, startDate:start,id:id},
//                         success:function()
//                         {
//                         $("#calendar").fullCalendar('refetchEvents');
//                          alert("Event Updated");
//                         }
//                        });
//                       },

//                       eventClick:function(event)
//                       {
//                        if(confirm("Are you sure you want to remove it?"))
//                        {
//                        var action ='delete-event';
//                         var id = event.id;
//                         $.ajax({
//                          url:"../queries/calendar-queries.php",
//                          type:"POST",
//                          data:{id:id},
//                          success:function()
//                          {
//                           $("#calendar").fullCalendar('refetchEvents');
//                           alert("Event Removed");
//                          }
//                         })
//                        }
//                       }
//                 });
// });


  $(document).ready(function() {
   var calendar = $('#calendar').fullCalendar({
    editable:true,
    header:{
     left:'prev,next today',
     center:'title',
     right:'month,agendaWeek,agendaDay'
    },
       /***** events ********/
    events: '../calendar/load-event.php',
    selectable:true,
    selectHelper:true,
    select: function(start, end, allDay)
    {
     var title = prompt("Enter Event Title");
     var details = prompt("Enter Event details:");
     if(title)
     {
      var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
      var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
         var action = 'add-event';
                     $.ajax({
                      url:"../queries/calendar-queries.php",
                      type:"POST",
                      data:{action:action, eventTitle:title, startDate:start, allDay:allDay, eventDetails:details},
                      success:function(data)
                      {
                        alert(data);
                        alert("Event Updated");
                       $("#calendar").fullCalendar("refetchEvents");
                     
                      }
                     });
     }
    },
    editable:true,
    eventResize:function(event)
    {
     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
     var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
     var title = event.title;
     var id = event.id;
     $.ajax({
      url:"update.php",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function(){
       calendar.fullCalendar('refetchEvents');
       alert('Event Update');
      }
     })
    },

    eventDrop:function(event)
    {
     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
     var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
     var title = event.title;
     var id = event.id;
     $.ajax({
      url:"update.php",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function()
      {
       calendar.fullCalendar('refetchEvents');
       alert("Event Updated");
      }
     });
    },

    eventClick:function(event)
    {
     if(confirm("Are you sure you want to remove it?"))
     {
      var id = event.id;
      $.ajax({
       url:"delete.php",
       type:"POST",
       data:{id:id},
       success:function()
       {
        calendar.fullCalendar('refetchEvents');
        alert("Event Removed");
       }
      })
     }
    },

   });
  });